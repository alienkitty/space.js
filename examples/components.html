<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <title>Components â€” Space.js</title>

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto+Mono&family=Roboto:wght@300&family=Gothic+A1:wght@400;700">
    <link rel="stylesheet" href="assets/css/style.css">

    <style>
        *, :after, :before {
            touch-action: unset;
        }

        body {
            position: unset;
        }
    </style>

    <script type="module">
        import { Interface, Line, Point, Reticle, TargetNumber, Tracker, Vector2, defer, ticker } from '../src/index.js';

        class ComponentItem extends Interface {
            constructor(view, index) {
                super('.component-item');

                this.view = view;
                this.index = index;

                const size = 92;

                this.width = size;
                this.height = size;
                this.animatedIn = false;

                this.initHTML();
                this.initViews();

                this.addListeners();
            }

            initHTML() {
                this.css({
                    position: 'relative',
                    boxSizing: 'border-box',
                    width: this.width,
                    height: this.height,
                    marginTop: 20,
                    display: 'flex',
                    justifyContent: 'center',
                    alignItems: 'center',
                    border: '1px solid rgba(var(--ui-color-triplet), 0.25)',
                    cursor: 'pointer',
                    pointerEvents: 'auto',
                    webkitUserSelect: 'none',
                    userSelect: 'none',
                    opacity: 0
                });

                this.number = new Interface('.number');
                this.number.css({
                    position: 'absolute',
                    left: 0,
                    top: -20,
                    letterSpacing: 1
                });
                this.number.text(this.index + 1);
                this.add(this.number);
            }

            initViews() {
                this.add(this.view);
            }

            addListeners() {
                this.element.addEventListener('click', this.onClick);
            }

            // Event handlers

            onClick = () => {
                if (this.animatedIn) {
                    this.view.animateOut();
                    this.animatedIn = false;
                } else {
                    this.view.animateIn();
                    this.animatedIn = true;
                }
            };

            // Public methods

            animateIn = (delay = 0) => {
                this.tween({ opacity: 1 }, 400, 'easeOutCubic', delay);

                this.view.animateIn();
                this.animatedIn = true;
            };
        }

        class Components extends Interface {
            constructor(context) {
                super('.components');

                this.context = context;

                this.items = [];

                this.initHTML();
                this.initViews();
            }

            initHTML() {
                this.css({
                    display: 'flex',
                    justifyContent: 'center',
                    alignItems: 'center',
                    flexWrap: 'wrap',
                    gap: 67
                });
            }

            initViews() {
                const width = 90;
                const height = 90;
                const halfWidth = Math.round(width / 2);
                const halfHeight = Math.round(height / 2);

                // Reticle
                const reticle = new Reticle();

                // Reticle with text
                const reticle2 = new Reticle();
                reticle2.setData({
                    primary: '127.0.0.1',
                    secondary: 'localhost'
                });

                // Tracker
                const tracker = new Tracker();
                tracker.target.set(halfWidth, halfHeight);
                tracker.update();
                tracker.css({
                    width,
                    height,
                    marginLeft: -halfWidth,
                    marginTop: -halfHeight
                });

                // Tracker with target number
                const tracker2 = new Tracker();
                tracker2.setData({ targetNumber: 1 });
                tracker2.target.set(halfWidth, halfHeight);
                tracker2.update();
                tracker2.css({
                    width,
                    height,
                    marginLeft: -halfWidth,
                    marginTop: -halfHeight
                });
                tracker2.lock();

                // Target number
                const number = new TargetNumber();
                number.setData({ targetNumber: 1 });

                // Line (canvas)
                const line = new Line(this.context);

                // Point
                const point = new Point();
                point.setData({
                    name: '127.0.0.1',
                    type: 'localhost'
                });

                // Point with multiple target numbers
                const point2 = new Point();
                point2.setData({
                    name: '127.0.0.1',
                    type: 'localhost'
                });
                point2.setTargetNumbers([1, 2, 3]);
                point2.lock();

                // Create components
                [reticle, reticle2, tracker, tracker2, number, line, point, point2].forEach((view, i) => {
                    const item = new ComponentItem(view, i);
                    this.add(item);
                    this.items.push(item);
                });

                // Public properties
                this.line = line;
            }

            // Public methods

            resize = async () => {
                await defer();

                // Line (canvas)
                const bounds = this.items[5].element.getBoundingClientRect();
                const left = Math.round(bounds.left);
                const top = Math.round(bounds.top);

                this.line.setStartPoint(new Vector2(left - 2, top + 93));
                this.line.setEndPoint(new Vector2(left + 90, top + 1));
                this.line.resize();
            };

            update = () => {
                this.line.update();
            };

            animateIn = () => {
                this.items.forEach((item, i) => item.animateIn(i * 50));
            };
        }

        class UI extends Interface {
            constructor() {
                super('.ui');

                this.initHTML();
                this.initCanvas();
                this.initViews();

                this.addListeners();
                this.onResize();
            }

            initHTML() {
                this.css({
                    minHeight: '100%',
                    display: 'flex',
                    justifyContent: 'center',
                    alignItems: 'center',
                    padding: '55px 0 125px',
                    pointerEvents: 'none',
                    webkitUserSelect: 'none',
                    userSelect: 'none'
                });
            }

            initCanvas() {
                this.canvas = new Interface(null, 'canvas');
                this.canvas.css({
                    position: 'absolute',
                    left: 0,
                    top: 0,
                    pointerEvents: 'none'
                });
                this.context = this.canvas.element.getContext('2d');
                this.add(this.canvas);
            }

            initViews() {
                this.components = new Components(this.context);
                this.add(this.components);
            }

            addListeners() {
                window.addEventListener('resize', this.onResize);
                ticker.add(this.onUpdate);
            }

            // Event handlers

            onResize = () => {
                const width = document.documentElement.clientWidth;
                const height = document.documentElement.clientHeight;
                const dpr = window.devicePixelRatio;

                this.canvas.element.width = Math.round(width * dpr);
                this.canvas.element.height = Math.round(height * dpr);
                this.canvas.element.style.width = width + 'px';
                this.canvas.element.style.height = height + 'px';
                this.context.scale(dpr, dpr);

                this.components.resize(width, height, dpr);
            };

            onUpdate = (time, delta, frame) => {
                this.context.clearRect(0, 0, this.canvas.element.width, this.canvas.element.height);

                this.components.update(time, delta, frame);
            };

            // Public methods

            animateIn = () => {
                this.components.animateIn();
            };
        }

        class App {
            static async init() {
                this.initViews();

                this.addListeners();
            }

            static initViews() {
                this.ui = new UI();
                document.body.appendChild(this.ui.element);
            }

            static addListeners() {
                window.addEventListener('load', this.onLoad);
                ticker.start();
            }

            // Event handlers

            static onLoad = () => {
                this.ui.animateIn();
            };
        }

        App.init();
    </script>
</head>
<body>
</body>
</html>
